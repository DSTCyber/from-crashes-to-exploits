# Buggy PNG parser

This directory contains the source code for a buggy, security-vulnerable PNG
image parser. The parser is a cut-down version of
[libpng](http://www.libpng.org/pub/png/libpng.html). The parser is incomplete,
and its sole purpose is to demonstrate how to develop exploits against simple
security vulnerabilities (i.e. stack overflows).

It goes without saying that this code should **NOT** be used anywhere other
than as an educational resource.

## Contents

* `crashes/`: Crashes from AFL. Minimized crashes (generated by `afl-tmin`) can
  be found under `crashes/min/`.
* `shellcode/`: Simple "Hello, world" shellcode and a driver program
  (`test_shellcode.c`) to test it.
* `src/`: Source code for buggy PNG parser.
* `buggy-png`: Prebuilt buggy PNG parser.
* `bugg-png.afl`: Prebuilt buggy PNG parser with AFL instrumentation.
* `crash-input`: The specific AFL-generated crash used in the presentation.
* `invoke.sh`: Bash script to run `buggy-png` in a consistent environment.

## License

The source code is derived from libpng, which is licensed under the [libpng
license](http://www.libpng.org/pub/png/src/libpng-LICENSE.txt).

Those files not derived from libpng are licensed under the MIT license.

## Building

Use the given Makefile to build the `buggy-png` executable. `buggy-png` is
built with the following flags (thanks to Moyix for the tips! 
https://twitter.com/moyix/status/969224111154221058):

* `-m32` Target x86
* `-O0` Disable optimisations
* `-g` Enable debug symbols
* `-Wall` Display all warnings
* `-z,norelro` Makes the GOT writable
* `-z execstack` Makes the stack executable
* `-no-pie` Prevent relocation
* `-fno-stack-protector` Disable stack cookies

You can also build `buggy-png.afl` to build an instrumented version of the PNG
parser that can be fuzzed with AFL.
