#!/bin/sh
#
# Invoke the target program in a consistent environment
#
# Adapted from https://stackoverflow.com/a/17775966
#

while getopts "de:h?" opt ; do
      case "$opt" in
        h|\?)
            printf "usage: %s -e KEY=VALUE prog [args...]\n" $(basename $0)
            exit 0
            ;;
        d)
            gdb=1
            ;;
        e)
            env=$OPTARG
            ;;
    esac
done

shift $(expr $OPTIND - 1)
prog=$(readlink -f $1)
shift

if [ -n "$gdb" ] ; then
    exec env - $env TERM=screen PWD=$PWD gdb -q --args $prog "$@"
else
    exec env - $env TERM=screen PWD=$PWD $prog "$@"
fi
